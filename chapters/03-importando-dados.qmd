---
title: "Analisando dados da Secretaria de Segurança Pública"
---

Dentro do `R`, existem inúmeras formas de se importar um conjunto de dados. Os dados podem ter os mais diversos formatos (extensões): 

* `csv`, _comma separated values_;
* `xlsx`, formato do Excel (ao baixar a planilha);
* `rds`^[É a forma mais recomendada, ao meu ver, de salvar objetos dentro do `R`. Um diferencial do `.rds` é que ele mantém a estrutura do objeto: ou seja, os atributos permanecem os mesmos.], formato nativo do `R`;
* `parquet`;
* muito mais! 

## Importando os pacotes no `R`

Como vimos, a primeira coisa a se fazer dentro de um script no `R` é fazer a importação dos pacotes (ou bibliotecas). 

:::callout-note
Um pacote é uma "caixa de ferramentas" extra que você instala no `R` para ganhar novas funcionalidades. Ele reúne códigos, dados e documentação em um único lugar. O termo biblioteca (library) refere-se ao local (a pasta no seu computador) onde esses pacotes ficam guardados.
:::

Geralmente, precisamos, primeiramente, instalar um pacote com a função `install.packages` e então "carregá-lo" para nosso ambiente, com a função `library`. Carregar um pacote significa, basicamente, dizer ao `R` que queremos utilizar um conjunto de ferramentas na nossa sessão. Dito isso: 

1. Sempre instala-se um pacote novo. Este processo só é feito uma vez, ou seja, utiliza-se a função `install.packages` apenas quando ainda não possuímos o pacote em nossa máquina. 
2. Após a primeira instalação, só é necessário instalar um pacote novamente caso ele tenha sido atualizado (lembra que a comunidade é ativa?). Caso não seja o caso, só é necessário "carregar" nosso pacote para a sessão. 

```{r}
#| eval: false
#| include: true
install.packages("tidyverse")
library(tidyverse)
```

Você pode ter notado que não utilizei as aspas ("") com a função `library`. Isso é opcional, você pode ou não utilizá-las. 

:::callout-tip 
## Dica 1
O pacote `pacman` permite que você faça, ao mesmo tempo, a instalação e o carregamento do pacote, com a função `p_load`. Ao invés de fazer, por exemplo: 

```{r}
#| eval: false
#| include: true
install.packages("tidyverse")
library(tidyverse)
```

você pode fazer apenas: 

```{r}
#| eval: false
#| include: true
p_load(tidyverse)
```

Isso é particularmente útil quando você precisa importar muitos pacotes!
:::

Caso você se esqueça de importar algum pacote, não se preocupe! É possível utilizar uma função de um pacote específico (desde que você tenha ele baixado no seu computador) sem precisar utilizar o `library(nome_do_pacote)` no começo do seu script. Ao especificar o nome do pacote e utilizar `::`, como demonstrado na @fig-dica-doispontos, é possível acessar a função desejada:

![Usando uma função sem carregar o pacote](../images/dica_pacote_doispontos.png){#fig-dica-doispontos width=80% fig-align="center"}

Agora, basta carregamos os pacaotes de interesse

```{r}
pacman::p_load(
              tidyverse, # pacotão com vários pacotes core 
              rio,       # pacote que facilita a leitura de qualquer formato
              readxl     # pacote para ler no formato .xlsx
               )
```

## Nosso conjunto de dados

Nosso conjunto de dados, para fins de exploração, serão as estatísticas dos dados criminais da Secretaria de Segurança Pública do Estado de São Paulo para o ano de 2025. Os dados estão disponíveis no [portal da SSP](https://www.ssp.sp.gov.br/estatistica).

### Lendo dados direto do site da Secretaria

Utilizando a função `import` do pacote `rio`, é possível copiar a `url` e ler diretamente da página do site da SSP. Ao passarmos o _mouse_ em cima do ano de 2025 nas [estatísticas de dados criminais da SSP](https://www.ssp.sp.gov.br/estatistica/consultas), podemos ver que, no final da página, nos é apresentado um link. Podemos copiar este link e lê-lo diretamente do `RStudio`, conforme apresentado na @fig-importacao-url:

![Importando URL](../images/importaca_url_sitessp.png){#fig-importacao-url fig-align="center"}



```{r}
#| eval: false
#| include: true
ssp_2025 <- rio::import("https://www.ssp.sp.gov.br/assets/estatistica/transparencia/spDados/SPDadosCriminais_2025.xlsx")
```


Visualindo as primeiras linhas:

```{r}
#| eval: false
#| include: true
glimpse(ssp_2025)
```

